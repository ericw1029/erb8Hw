{% extends 'base.html' %}
<!-- load humanize -->
{% load humanize %}
<!-- tab title -->
 {% block title%} | Welcome {% endblock %}
<!-- index main content -->
{% block content %}
<div class="container">
    <div class="container">
        <!-- Display messages -->       
        {% include 'partials/_alert.html' %}
        <!-- Import Section -->
        <div class="import-section">
            <h2>Import CSV File</h2>
            <form method="post" enctype="multipart/form-data">
                {% csrf_token %}
                
                <div class="form-group">
                    <label for="id_model_type">Select Model:</label>
                    <select name="model_type" id="id_model_type" class="form-control" required>
                        <option value="">-- Select Model --</option>
                        <option value="customer" {% if form.model_type.value == "customer" %}selected{% endif %}>Customer</option>
                        <option value="product" {% if form.model_type.value == "product" %}selected{% endif %}>Product</option>
                        <option value="order" {% if form.model_type.value == "order" %}selected{% endif %}>Order</option>
                    </select>
                    {% if form.model_type.errors %}
                        <div class="error">{{ form.model_type.errors }}</div>
                    {% endif %}
                </div>
                
                <div class="form-group">
                    <label for="{{ form.csv_file.id_for_label }}" class="form-label">
                            <strong>{{ form.csv_file.label }}</strong>
                    </label>
                    {{ form.csv_file }}
                    {% if form.csv_file.help_text %}
                                <div class="form-text">{{ form.csv_file.help_text }}</div>
                    {% endif %}
                                
                    {% if form.csv_file.errors %}
                        <div class="alert alert-danger mt-2">
                                        {% for error in form.csv_file.errors %}
                                        {{ error }}
                                        {% endfor %}
                        </div>
                    {% endif %}
                </div>
                
                <div class="form-group">                    
                    <div class="row">
                        <div class="col-6 justify-content-md-start">
                            {{form.delete_option }}
                        </div>
                        <div class="col-6 d-flex justify-content-md-end">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="bi bi-upload"></i> Upload and Import
                            </button>
                        </div>
                       
                    </div>
                </div>
            </form>
            
            <!-- CSV Format Instructions -->
            <div style="margin-top: 30px; background: #f8f9fa; padding: 15px; border-radius: 5px;" hidden>
                <h3>CSV Format Instructions:</h3>
                <h4>Customers:</h4>
                <pre>name,email,phone,address
John Doe,john@example.com,1234567890,123 Main St</pre>
                
                <h4>Products:</h4>
                <pre>name,sku,description,price,stock_quantity,weight
Product A,SKU001,Description here,99.99,100,1.5</pre>
                
                <h4>Orders:</h4>
                <pre>customer_email,product_sku,quantity,order_date,status,total_amount
john@example.com,SKU001,2,2024-01-15 10:30:00,processing,199.98</pre>
            </div>
        </div>
        
        <!-- Error Log Display (if any errors) -->
        {% if messages %}
            {% for message in messages %}
                {% if message.tags == 'warning' and error_details %}
                    <div class="error-log mt-4">
                        <h5><i class="bi bi-exclamation-triangle"></i> Recent Errors (first 20):</h5>
                        {% for error in error_details %}
                            <div class="error-item">{{ error }}</div>
                        {% endfor %}
                    </div>
                {% endif %}
            {% endfor %}
        {% endif %}

        <!-- Export Section -->
        <div class="export-section mt-5">
            <h2>Export Data as CSV</h2>
            <p>Download data as CSV files:</p>
            <div>
                <a href="{% url 'pages:export_csv' 'customer' %}" class="btn" style="background: #28a745;">Export Customers</a>
                <a href="{% url 'pages:export_csv' 'product' %}" class="btn" style="background: #17a2b8;">Export Products</a>
                <a href="{% url 'pages:export_csv' 'order' %}" class="btn" style="background: #6c757d;">Export Orders</a>
            </div>
        </div>
    </div>
</div>

{% endblock %}